openapi: 3.0.3
info:
  title: CardioVoice API
  version: "0.1.0"
  description: >
    CardioVoice backend API - analyze audio + profile to return risk scores and an AI explanation.
servers:
  - url: http://localhost:5000
paths:
  /api/v1/analyze:
    post:
      summary: Analyze voice + profile -> risk scores + AI explanation
      operationId: analyze
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - age
                - gender
                - smoking_status
                - activity_level
                - audio
              properties:
                age:
                  type: integer
                  format: int32
                  example: 45
                  description: "Age in years (18-100)"
                gender:
                  type: string
                  example: "male"
                  description: "male | female"
                smoking_status:
                  type: string
                  example: "smoker"
                  description: "smoker | non-smoker"
                activity_level:
                  type: string
                  example: "sedentary"
                  description: "sedentary | moderate | active"
                audio:
                  type: string
                  format: binary
                  description: "User voice recording file (.wav, .mp3, .m4a, .ogg)"
      responses:
        '200':
          description: Successful analysis
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      risk_scores:
                        type: object
                        description: "Risk scores returned by mock/real ML model"
                        additionalProperties:
                          type: number
                          format: float
                        example:
                          "АГ (Гипертензия)": 0.45
                          "СД2 (Диабет)": 0.12
                          "ИБС (Сердце)": 0.30
                      ai_explanation:
                        type: string
                        description: "Russian text explanation generated by the CardioChat LLM"
                        example: "Краткий вывод: повышенный риск ... Данная информация носит ознакомительный характер..."
        '400':
          description: Bad request (validation error)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missing_field:
                  summary: Missing audio
                  value:
                    status: error
                    message: "Audio file missing"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /health:
    get:
      summary: Health check
      description: Returns service status and mode (mock/real)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  mode:
                    type: string
                    example: mock

components:
  schemas:
    Profile:
      type: object
      required:
        - age
        - gender
        - smoking_status
        - activity_level
      properties:
        age:
          type: integer
          format: int32
        gender:
          type: string
          enum: [male, female]
        smoking_status:
          type: string
          enum: [smoker, non-smoker]
        activity_level:
          type: string
          enum: [sedentary, moderate, active]
    ErrorResponse:
      type: object
      properties:
        status:
          type: string
          example: error
        message:
          type: string
          example: "Invalid profile data"
        errors:
          type: array
          items:
            type: object
            description: "Validation error objects (optional, from Pydantic)"
